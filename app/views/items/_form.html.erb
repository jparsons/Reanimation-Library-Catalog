<%- content_for :head do -%>
<script>
$(document).ready(function(){
	$("#item_publisher_name").autocomplete({
	    source: <%= raw Item.all.map{|i| i.publisher_name}.uniq.compact.sort.to_json %>
	});
	$("#item_physical_format").autocomplete({
		source: <%= raw Item.all.map(&:physical_format).uniq.compact.sort.to_json %>
	});
	$("#item_series_name").autocomplete({
		source: <%= raw Item.all.map(&:series_name).uniq.compact.sort.to_json %>
	});
})
</script>
<%- end -%>
<%= form_for @item, :html => { :multipart => true } do |f| %>

<p><%= f.label :title %><br />
	<%= f.text_field :title, size: 75 %></p>
<p><%= f.label :subtitle %><br />
	<%= f.text_field :subtitle, size: 75 %></p>
  <!-- add title translation - should be added to search index -->
	<p><%= f.label :cover_image %></p>
	<%= image_tag(@item.cover_image.url(:thumb)) if @item.cover_image.file? %>
	<p>Upload a new cover image<br />
	<%= f.file_field :cover_image %></p>
  <p>
    <%= f.label :collection %><br />
    <%= f.select :collection_name, COLLECTIONS, :include_blank=>true %>
  </p>
  <p>
    <%= f.label :series %><br />
    <%= f.text_field :series_name %>
  </p>
  <p>
    <%= f.label :edition %><br />
    <%= f.text_field :edition %>
  </p>
<p><%=f.label :creators %>
</p>
<div id="creators">
  <%= f.fields_for :creators do |creator_form| %>
    <%= render :partial => 'creator', :locals => {:f => creator_form} %>
  <% end %>
</div>
<p><%= link "click here to add a new creator", "#" %>  </p>

<div id ="publisher">
<h2>Publication Information</h2>
<p><%= f.label :publisher_name %><br />
	<%= f.text_field :publisher_name %></p>
<p><%= f.label :city %><br />
    <%= f.text_field :publisher_city %></p>
<p><%= f.label :state %><br />
	<%= f.select :publisher_state, STATES, :include_blank=>true %></p>
<p><%= f.label :country %><br />
	<%= f.select :publisher_country, COUNTRIES, :include_blank=>true %></p>
<p><%= f.label :copyright, "Copyright Year" %><br />
	<%= f.text_field :copyright %></p>
<p><%= f.label :corporate_author %><br />
	<%= f.text_field :corporate_author %>
	</p>
<p><%= f.label :is_government_document, "Is government document?" %><br />
	<%= f.select :is_government_document, {"no"=>"false", "yes"=>"true" } %>
</p>


</div>
<div id="physical_description">
	<h2>Physical Description</h2>
	<p><%= f.label :extent %><br />
		<%= f.text_field :extent %></p>
	<p><%= f.label :item_size %><br />
		<%= f.text_field :item_size %></p>
	<p><%= f.label :format %><br />
		<%= f.select :physical_format, FORMATS, :include_blank => true %></p>
</div>
<div id="image-colors" class="scrolling-subform">
  <h2>Image Colors</h2>
  <% for image_color in ImageColor.all(:order=>"name") %>
    <div>
	  <%= check_box_tag "item[image_color_ids][]", image_color.id, @item.image_colors.include?(image_color) %>
	  <%= raw(image_color.name) %>
	</div>
  <% end %>

</div>
<div id="image-types" class="scrolling-subform">
  <h2>Image Types</h2>
  <% for image_type in ImageType.all(:order=>"name") %>
    <div>
	  <%= check_box_tag "item[image_type_ids][]", image_type.id, @item.image_types.include?(image_type) %>
	  <%= raw(image_type.name) %>
	</div>
  <% end %>

</div>
<div id="identifiers">
	<h2>Identifiers</h2>
	<p><%= f.label :call_number %><br />
		<%= f.text_field :call_number %></p>
	<p><%= f.label :barcode %><br />
		<%= f.text_field :barcode %></p>
	<p><%= f.label :isbn_issn, "ISBN / ISSN" %><br />
		<%= f.text_field :isbn_issn %></p>
</div>
<div id="language">
	<p><%= f.label :languages %><br />
		<div id="item-languages" class="scrolling-subform">
  	  <% for language in Language.order(:name) %>
  	    <%= check_box_tag "item[language_ids][]", language.id, @item.languages.include?(language) %>	<%= language.name %> <br />
     <% end %>
  	</div>
</div>
<div id="location">
	<p><%= f.label :location %><br />
		<%= f.text_field :location %></p>
</div>
<div id="metadata">
	<h2>Metadata</h2>
	<p><%= f.label :has_marc_record, "Has a MARC record?" %><br />
		<%= f.select :has_marc_record, {"no"=>"false", "yes"=>"true"} %>
	</p>
	<p><%= f.label :needs_translation, "Needs Translation?" %><br />
		<%= f.select :needs_translation, {"no"=>"false", "yes"=>"true"} %>
	</p>
	<p><%= f.label :metadata_notes %><br />
		<%= f.text_area :metadata_notes %>
	</p>
</div>
<%= render :partial=>'acquisition_form', :locals=>{:f=>f}%>
<p><%= f.label :subjects %></p>
<%= f.fields_for :subjects do |subject_form| %>
  <%= render :partial => 'subject', :locals => {:f => subject_form} %>
<% end %>
<p><%= add_child_link "... click here to add new subjects", f, :subjects, "$('.new-subject-textbox').autocomplete({ source: #{Subject.all.map(&:name).uniq.compact.sort.to_json}  });" %></p>
<!-- can we match just the start of subjects -->
<div id="subjects">

</div>
<% unless @item.published? %><%= f.submit SAVE_UNPUBLISHED_TEXT %>&nbsp;&nbsp;<%= f.submit PUBLISH_TEXT %><% else %><%= f.submit SAVE_PUBLISHED_TEXT %>&nbsp;&nbsp;<%= f.submit UNPUBLISH_TEXT %><% end %>
<% end %>
